upstream goodcode {
  server localhost:4000;
}

##http to https redirect
#server {
#  server_name goodcode.com;
#  return 301 https://goodcode.com$request_uri;
#}
#

# resource server
server {
  server_name www.goodcode.in goodcode.in;

  root /opt/www/goodcode/public;

  #rewrite favicon.ico redirect from non root locations to the root favicon
  rewrite ^/(.*)/favicon.ico$ /favicon.ico last;
  keepalive_timeout 5;

  location / {
    proxy_set_header  host              $http_host;
    proxy_set_header  x-real-ip         $remote_addr;
    proxy_set_header  x-forwarded-for   $proxy_add_x_forwarded_for;
    proxy_set_header  x-forwarded-proto $scheme;

    proxy_redirect off;
    proxy_pass http://goodcode;

    gzip_proxied any;
  }

  location /.well-known {
    root /opt/www/goodcode/public;
  }

  # Rails error pages
# TODO: fix these paths
  error_page 500 502 503 504 /500.html;
  location = /500.html {
    root /opt/www/goodcode/public;
  }

}

## gzip
#  gzip on;
#  gzip_proxied any;
#  gzip_types text/plain text/xml text/css application/x-javascript; #text/html is always compressed
#  gzip_vary on;
#  gzip_disable "msie6"; #disables on IE<=6
#
#  #trailing slash rewerite
#  #rewrite ^(.*[^/])$ $1/ permanent;
#
#  # ~2 seconds is often enough for most folks to parse HTML/CSS and
#  # retrieve needed images/icons/frames, connections are cheap in
#  # nginx so increasing this is generally safe...
#  keepalive_timeout 5;
#
#  client_max_body_size 10M;
#
#
#  location / {
#    proxy_set_header  host              $http_host;
#    proxy_set_header  x-real-ip         $remote_addr;
#    proxy_set_header  x-forwarded-for   $proxy_add_x_forwarded_for;
#    proxy_set_header  x-forwarded-proto $scheme;
#
#    proxy_redirect off;
#    proxy_pass http://goodcode_rs;
#
##proxy_cache large-cache;
##proxy_cache_key $host$request_uri;
##proxy_cache_valid 200 302 2m;
##proxy_cache_valid 404     1m;
#
#    gzip_proxied any;
#  }
#
#  # Rails error pages
## TODO: fix these paths
#  error_page 500 502 503 504 /500.html;
#  location = /500.html {
#    root /opt/www/goodcode/app/public;
#  }
#}
#
## config for LE
##server {
##  server_name goodcode.com www.goodcode.com;
##  root /opt/www/goodcode/app/public;
##}
#
### www to non-www
### TODO: setup this for SSL too
##server {
##  server_name www.goodcode.com;
##  return 301 https://goodcode.com$request_uri;
##}
##
#
##
##server{
##  listen              443 ssl;
##  server_name www.goodcode.com;
##
##  ssl_protocols       TLSv1 TLSv1.1 TLSv1.2;
##  ssl_ciphers         HIGH:!aNULL:!MD5;
##  ssl on;
##  ssl_certificate /etc/letsencrypt/live/goodcode.com/fullchain.pem;
##  ssl_certificate_key /etc/letsencrypt/live/goodcode.com/privkey.pem;
##
##  return 301 https://goodcode.com$request_uri;
##}
#
#server {
#  listen              443 ssl;
#  server_name goodcode.com;
#  # TODO: fix the path to the public dir, maybe symlink it to the right priv/static location
#  root /opt/www/goodcode/app/public;
#  ssl_protocols       TLSv1 TLSv1.1 TLSv1.2;
#  ssl_ciphers         HIGH:!aNULL:!MD5;
#  ssl on;
#  ssl_certificate /etc/letsencrypt/live/goodcode.com/fullchain.pem;
#  ssl_certificate_key /etc/letsencrypt/live/goodcode.com/privkey.pem;
#
##rewrite favicon.ico redirect from non root locations to the root favicon
#  rewrite ^/(.*)/favicon.ico$ /favicon.ico last;
#
## gzip
#  gzip on;
#  gzip_proxied any;
#  gzip_types text/plain text/xml text/css application/x-javascript; #text/html is always compressed
#  gzip_vary on;
#  gzip_disable "msie6"; #disables on IE<=6
#
#  #trailing slash rewerite
#  #rewrite ^(.*[^/])$ $1/ permanent;
#
#  # ~2 seconds is often enough for most folks to parse HTML/CSS and
#  # retrieve needed images/icons/frames, connections are cheap in
#  # nginx so increasing this is generally safe...
#  keepalive_timeout 5;
#
#  client_max_body_size 10M;
#
#  location / {
#    try_files $uri @proxy;
#  }
#
#  location @proxy{
#    proxy_set_header  host              $http_host;
#    proxy_set_header  x-real-ip         $remote_addr;
#    proxy_set_header  x-forwarded-for   $proxy_add_x_forwarded_for;
#    proxy_set_header  x-forwarded-proto $scheme;
#
#    proxy_redirect off;
#    proxy_pass http://goodcode;
#
##proxy_cache large-cache;
##proxy_cache_key $host$request_uri;
##proxy_cache_valid 200 302 2m;
##proxy_cache_valid 404     1m;
#
#    gzip_proxied any;
#  }
#
#  # Rails error pages
#  # TODO: fix paths
#  error_page 500 502 503 504 /500.html;
#  location = /500.html {
#    root /opt/www/goodcode/app/public;
#  }
#}
